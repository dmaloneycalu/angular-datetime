/*! angular-datetime Copyright Vokal 2015 */
angular.module("vokal.datePicker",[]).directive("datePicker",["$compile","$filter","$document",function(a,b,c){"use strict";function d(a){return!!a&&angular.isFunction(a.getTime)&&!isNaN(a.getTime())}function e(a){return d(a)?a:new Date(a)}var f="M/d/yyyy";return{restrict:"A",scope:{date:"=ngModel"},require:"ngModel",link:function(g,h,i,j){function k(a){return"string"===i.pickerType?b("date")(a,i.datePicker||f):a}function l(a){return k(g.date?new Date(a.toDateString()+" "+e(g.date).toTimeString()):a)}j.$parsers.unshift(function(a){a=new Date(a);var b=d(a);return j.$setValidity("date",b),b?l(a):g.date}),j.$formatters.push(function(a){var c=e(a),g=d(c);return j.$setValidity("date",g),g?b("date")(c,i.datePicker||f):a}),g.showDatepicker=!1;var m=new Date;g.dayNow=m.getDate(),g.monthNow=m.getMonth()+1,g.yearNow=m.getFullYear(),g.dayNames=["Su","Mo","Tu","We","Th","Fr","Sa"],g.buildMonth=function(a,c){g.days=[],g.filler=[],g.year=a,g.month=c,g.monthName=b("date")(a+"-"+(10>c?"0":"")+c+"-01","MMMM"),g.prevYear=1>c-1?a-1:a,g.nextYear=c+1>12?a+1:a,g.prevMonth=1>c-1?12:c-1,g.nextMonth=c+1>12?1:c+1;for(var d=32-new Date(a,c-1,32).getDate(),e=new Date(a,c-1,1).getDay(),f=1;d>=f;f++)g.days.push(f);for(var h=0;e>h;h++)g.filler.push(h)},g.applyDate=function(a){var c=new Date(a),d=b("date")(c,i.datePicker||f);j.$setViewValue(d),j.$render(),g.showDatepicker=!1};var n=angular.element('<div class="date-picker" data-ng-show="showDatepicker"><div class="month-name">{{ monthName }} {{ year }}</div><div class="month-prev" data-ng-click="buildMonth( prevYear, prevMonth )">&lt;</div><div class="month-next" data-ng-click="buildMonth( nextYear, nextMonth )">&gt;</div><div class="day-name-cell" data-ng-repeat="dayName in dayNames">{{ dayName }}</div><div class="filler-space" data-ng-repeat="space in filler"></div><div class="date-cell" data-ng-class="{ today: dayNow == day && monthNow == month && yearNow == year }" data-ng-repeat="day in days" data-ng-click="applyDate( month + \'/\' + day + \'/\' + year )">{{ day }}</div></div>');a(n)(g),h.after(n),h.on("click",function(){g.$apply(function(){var a,b;if(Date.parse(j.$modelValue)){var c=new Date(j.$modelValue);a=c.getFullYear(),b=c.getMonth()+1}else a=g.yearNow,b=g.monthNow;g.buildMonth(a,b),g.showDatepicker=!0})}),h.on("keydown paste",function(){g.$apply(function(){g.showDatepicker=!1})});var o=function(a){h[0].contains(a.target)||g.$apply(function(){g.showDatepicker=!1})};c.on("click touchstart",o),g.$on("$destroy",function(){c.off("click touchstart",o)})}}}]);