/*! angular-datetime Copyright Vokal 2015 */
angular.module("vokal.timePicker",[]).directive("timePicker",["$compile","$filter",function(a,b){"use strict";function c(a){return!!a&&angular.isString(a)&&!isNaN(new Date(g+a).getTime())}function d(a){return!!a&&angular.isFunction(a.getTime)&&!isNaN(a.getTime())}function e(a){return d(a)?a:new Date(a)}var f="h:mm a",g="1/1/1990 ";return{restrict:"A",scope:{date:"=ngModel"},require:"ngModel",link:function(h,i,j,k){function l(a){return"string"===j.pickerType?b("date")(a,j.timePicker||f):a}function m(a){return l(h.date?new Date(e(h.date).toDateString()+" "+a):new Date(g+a))}k.$parsers.unshift(function(a){var b=c(a);return k.$setValidity("time",b),b?m(a):h.date}),k.$formatters.push(function(a){var c=e(a),g=d(c);return k.$setValidity("time",g),g?b("date")(c,j.timePicker||f):a}),h.times=[],h.showTimepicker=!1;for(var n,o,p,q=j.pickerInterval?parseInt(j.pickerInterval,10):60,r=0;24>r;r++)for(var s=0;60>s;s+=q)o=10>s?"0"+s:s,n=new Date(g+r+":"+o),p=b("date")(n,j.timePicker||f),h.times.push(p);h.applyTime=function(a){k.$setViewValue(a),k.$render(),h.showTimepicker=!1};var t=angular.element('<ol class="time-picker" data-ng-show="showTimepicker"><li data-ng-repeat="time in times" data-ng-click="applyTime( time )">{{ time }}</li></ol>');a(t)(h),i.after(t),i.on("click",function(){h.$apply(function(){h.showTimepicker=!0})}),i.on("keydown paste",function(){h.$apply(function(){h.showTimepicker=!1})}),angular.element(document.getElementsByTagName("html")[0]).on("mousedown touchstart",function(a){if(h.showTimepicker){for(var b=angular.element(a.target).scope();b;b=b.$parent)if(h.$id===b.$id)return;h.$apply(function(){h.showTimepicker=!1})}})}}}]);