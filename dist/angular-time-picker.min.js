/*! angular-datetime Copyright Vokal 2015 */
angular.module("vokal.timePicker",[]).directive("timePicker",["$compile","$filter","$document",function(a,b,c){"use strict";function d(a){return!!a&&angular.isString(a)&&!isNaN(new Date(h+a).getTime())}function e(a){return!!a&&angular.isFunction(a.getTime)&&!isNaN(a.getTime())}function f(a){return e(a)?a:new Date(a)}var g="h:mm a",h="1/1/1990 ";return{restrict:"A",scope:{date:"=ngModel"},require:"ngModel",link:function(i,j,k,l){function m(a){return"string"===k.pickerType?b("date")(a,k.timePicker||g):a}function n(a){return m(i.date?new Date(f(i.date).toDateString()+" "+a):new Date(h+a))}l.$parsers.unshift(function(a){var b=d(a);return l.$setValidity("time",b),b?n(a):i.date}),l.$formatters.push(function(a){var c=f(a),d=e(c);return l.$setValidity("time",d),d?b("date")(c,k.timePicker||g):a}),i.times=[],i.showTimepicker=!1;for(var o,p,q,r=k.pickerInterval?parseInt(k.pickerInterval,10):60,s=0;24>s;s++)for(var t=0;60>t;t+=r)p=10>t?"0"+t:t,o=new Date(h+s+":"+p),q=b("date")(o,k.timePicker||g),i.times.push(q);i.applyTime=function(a){l.$setViewValue(a),l.$render(),i.showTimepicker=!1};var u=angular.element('<ol class="time-picker" data-ng-show="showTimepicker"><li data-ng-repeat="time in times" data-ng-click="applyTime( time )">{{ time }}</li></ol>');a(u)(i),j.after(u),j.on("click",function(){i.$apply(function(){i.showTimepicker=!0})}),j.on("keydown paste",function(){i.$apply(function(){i.showTimepicker=!1})});var v=function(a){j[0].contains(a.target)||i.$apply(function(){i.showTimepicker=!1})};c.on("mousedown touchstart",v),i.$on("$destroy",function(){c.off("mousedown touchstart",v)})}}}]);